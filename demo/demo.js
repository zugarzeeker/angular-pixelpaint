var app = angular.module('demo', ['ngSanitize', 'angularPixelPaint']);

app.controller('DemoController', ['$scope', '$log', '$timeout', '$document', function($scope, $log, $timeout, $document) {

  $scope.shouldGenerateOutputImage = false;
  $scope.selectedTool = 'move';
  $scope.paintOptions = {
          cellSize: 10,
          largeGridEvery: 10,
          gridLineWidth: 1,
          gridSubDivisionLineWidth: 0.5,
          imageWidth: 18 * 4,
          imageHeight: 18 * 3,
          showGrid: true,
          imageData: null,
          brushColor: [0,0,0],
          paintEnabled: true,
        };

  //var imageBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAACnVBMVEUAAAA6OjpcXFwFBQUAAAA3Njfo5+cjIyMbGxs6OjpjY2MODg4LDAzf399GR0c7PT03ODhvcG/f3t5SUlKmpqYODg5ycnItLS0QDw8ICAiop6cBAgLS0tJlZGS/vr6Xl5fW1dWenZ3X19eKiop4eXhoaGgmJia+vr5DRkYzNTTm5uYgICAwMDBdXV3ExMR+fn0iISFlZGQ4ODhbW1ubmppmZmYoKiqSkpLJyMh8fHtfX19KSkrd3NzS0dEgICBYWFiAgICJiYlzc3MwMDCysbFcXFx0c3N3d3aFhYSko6KQkJCLyOeXqNdol8e3traenp2XlpaNi4tvbm3q7e5UvO7i6Os5q+vp6elHrOORvuBAntljoNIvjtKBm8+OocgeeMdciL4/e7pTh7cobLeysbCpqKeBgIBlZWVRUlFVwPA9tfDe6u/F3us6metNtuo5p+amyOV/vuU3oePI1uF4uuFVpeFEp98tmN8zmt60utyirtp6rNibrNVwpNMlidONstI/ktF6pNBVm9B+oc7Ny8txm8pblMk8fMlWkMQpfsTEw8NjlcKptsEzd716mLxzkrtNfrmDnbhcfLhsj7Vvh7N1kbGZo66LlaWQlp5teJ2Mkpybm5qIj5qDhox+g4d8fXxAQD/JTilgqfPS4vF8w/Cs0+82pO9nwu1Tkuje4uW1y+VAquVFjuVtt+RYsuNCluBgrdyCtNurtNgyk9hTo9eJqNOHpNM4ltOSodLR0NDHy8+ot8xfmMtrpMpmkcdNjsa0vcU3iMVHfsWNrcSYq8BXe8CKlL0VbL27u7sjarZ+jbVbhrVOe7RBarEWXLEzZK+ImK55hKmDjaeCf6FWeJ1UaJCEe46wjYprYHtxdHSRXWFXV1eASlSuTjuiQTUEnl26AAAAR3RSTlMA/v0bEA3ozaBwW09H+/Dty8O7loZYUUg/NiwqKSUZCf738/Lx7+zm5OPc1tPIxb68u7mqppyalpSQj4uEfHVyb0Y9OTctGa8zTnIAAAHjSURBVCjPYoABRzExeQZsgEvE3EVGDlNOxkKJl41NS8hWCkVYzoZtZ2qgh0egv5+6iBtCXEpIIcB93qzp0+fMc0/z0neFicvqdaXNvRC3qaqqJu7SXPd0XVmIOKvJCY9ZfVt9Kit9fHx2nJrjftuYFeIeRa8Zk1ubm+NqtsXGHrs8ZUYQExdYg2FgwFRfIGhc1brv4q2ZCVO9mARBWpxVPaYldXS07ald3Djz7o0JZ5KmBak4ASU4gwImJibub9pY3XZt4Z3ECVP6jwS6OwAlrN09J/cmJ3c29V5deG93QcKkSX2e7pZACcCE0zxPnz+bXFsQvev6lcItnSfPJaS4mwIlrLw8+4/GHoquLj6QtKEwKirmeLdfkDBQwj4gdWJ7e3x8fU935Np1EWUx8fV+TJxACXFlz56GurrowwdjlpYW5UVsbij25xMHSjALerREVkTt3V5eXro+P2R1RSRvugAzA8i9TP4rS8oiwvKL1qzIzQwrCZ3NaAcOEmajDL9Q77ysrLDcRctCvENTFhgwQ0JRQicjJTjHe3lmyBLvnPDUBdoSsHDnYWec3xIenJ0dHN41n5GdGxFTkhxqjOkes/29bmbwc0gixy0LNwe7Jj+fhoAZNwtaamCR5hEV5ZGGCwMAQvCdr1XGESgAAAAASUVORK5CYII=";
  var imageBase64 = "data:image/jpeg;base64,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";
  $scope.paintLayers = [
  {
      "type": "image",
      "image": imageBase64
  },
  {
      "type": "text",
      "text": "ภาษาไทย",
      "color": "#00ff00",
      "fontFamily": "Itim",
      "fontSize": "20px"
  }
  ,
  {
      "type": "text",
      "text": "ภาพ",
      "color": "#ff0000",
      "active": true,
      "fontSize": "20px",
      "offsetX": "20",
      "offsetY": "5"
  }
  ];

  $scope.zoomIn = function() {
    $scope.paintOptions.cellSize++;
  }

  $scope.zoomOut = function() {
    $scope.paintOptions.cellSize--;
  }

  $scope.generateOutputImage = function(){
    $scope.shouldGenerateOutputImage = true;
    $timeout(() => {
      $scope.outputImageUrl = imageDataToURL($scope.outputImage, $document);
    });
  };

  var imageDataToURL = function(imgData, $document){
    var c = imageDataToCanvas(imgData, $document);
    return c.toDataURL("image/png");
  };

  var imageDataToCanvas = function(imgData, $document){
    var outCanvas = $document[0].createElement('canvas');
    outCanvas.width = imgData.width;
    outCanvas.height = imgData.height;
    var outCtx = outCanvas.getContext('2d');
    outCtx.putImageData(imgData, 0, 0);
    return outCanvas;
  };

}]);
